<!DOCTYPE html>
<html>
  <head>
    <title>pgmonitor</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.52" />
<title>Setting up Grafana :: pgmonitor</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<link href="../css/nucleus.css" rel="stylesheet">
<link href="../theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="../css/bootstrap.min.css">
<link href="../css/custom.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<script src="../js/jquery-2.x.min.js"></script>
<script src="../js/toc.js"></script>
<script type="text/javascript">
      var baseurl = "";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/grafana/">
    
      <header>
  <div class="logo">
    
	
  
    <a href="https://www.crunchydata.com/"><img alt="Crunchy Data" src="../images/logo.svg"></a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/CrunchyData/pgmonitor"  rel="noopener">
                  <i class='fab fa-github'></i> <label>GitHub</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/CrunchyData/pgmonitor/blob/master/LICENSE"  rel="noopener">
                  <i class='fas fa-file-contract'></i> <label>License</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>

    <ul class="menu">
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="../js/lunr.min.js"></script>
        <script type="text/javascript" src="../js/auto-complete.js"></script>
        <link href="../css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "";
          
        </script>
        <script type="text/javascript" src="../js/search.js"></script>
      </div>

      <hr>
      <a class="baselink" href="../">pgmonitor</a>
      <hr>
        <b>Available Formats</b>
        <nav class="downloads">
                <li class="" role="">
                    <a href="../pdf/pgmonitor.pdf"  rel="noopener">
                      <i class='fas fa-file-pdf'></i> <label>PDF</label>
                    </a>
                </li>
        </nav>
        <hr>

      <b>Navigation</b>
          <li data-nav-id="/" class="dd-item">
          <a href="../">
            Home
          </a>
          </li>
    <li data-nav-id="/exporter/" class="dd-item
        ">
      <div>
      <a href="../exporter/">Setting up Exporters</a>

      </div>
    </li>
    <li data-nav-id="/grafana/" class="dd-item parent active
        ">
      <div>
      <a href="../grafana/">Setting up Grafana</a>

      </div>
    </li>
    <li data-nav-id="/prometheus/" class="dd-item
        ">
      <div>
      <a href="../prometheus/">Setting up Prometheus</a>

      </div>
    </li>
    <li data-nav-id="/contributing/" class="dd-item
        ">
      <div>
      <a href="../contributing/">Contributing</a>

      </div>
    </li>




      <hr><b>Table of Contents</b>
<nav id="TableOfContents"></nav>



      <section>
      </section>
    </ul>
  </aside>
  <section class="page">

    <div class="nav-select">
      <center>Navigation :
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/exporter/" >
   Setting up Exporters</option>
    <option value="/grafana/"  selected>
   Setting up Grafana</option> 
  
    <option value="/prometheus/" >
   Setting up Prometheus</option>
    <option value="/contributing/" >
   Contributing</option>



        </select>
      </center>
    </div>

    
      <div id="top-bar">
        <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            <span class="links">
            




 <a href='../'></a> > Setting up Grafana

 


            </span>
        </div>

      </div>
    

    
    <div id="body-inner">

    <h1>Setting up Grafana</h1>

    
    
    



<p>There are RPM packages available to <a href="https://www.crunchydata.com">Crunchy Data</a> customers through the <a href="https://access.crunchydata.com/">Crunchy Customer Portal</a>. Otherwise the Grafana RPM Package can be downloaded and installed from <a href="https://grafana.com/grafana/download">https://grafana.com/grafana/download</a>. There is no difference between the Crunchy provided package and the one directly from Grafana.</p>

<h2 id="installation">Installation</h2>

<h3 id="upgrading">Upgrading</h3>

<p>If you&rsquo;d like to take advantage of the new provisioning system in Grafana 5 provided by pgmonitor 2.x, we recommend either renaming or deleting your existing datasources and dashboards so there are no issues when the provisioned versions are imported.</p>

<p>When upgrading from pgmonitor 1.x to 2.x, note that many of the system related metric names from node_exporter have had their names changed. The new graphs provided for Grafana 5+ have taken these new names into account. Also, the top level PostgreSQL Overview dashboard no longer uses the ccp_is_ready metric, so you will have to include some new postgres_exporter metrics for that dashboard to work.</p>

<h3 id="with-rpm-packages">With RPM Packages</h3>

<p>There are RPM packages available to <a href="https://www.crunchydata.com">Crunchy Data</a> customers through the <a href="https://access.crunchydata.com/">Crunchy Customer Portal</a>.</p>

<p>If you install the below available packages with RPM, you can continue reading at the <a href="#setup">Setup</a> section.</p>

<h4 id="available-packages">Available Packages</h4>

<table>
<thead>
<tr>
<th>Package Name</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>grafana</td>
<td>Base package for grafana</td>
</tr>

<tr>
<td>pgmonitor-grafana-extras</td>
<td>Crunchy configurations for datasource &amp; dashboard provisioning</td>
</tr>
</tbody>
</table>

<h4 id="without-packages">Without Packages</h4>

<p>Create the following directories on your grafana server if they don&rsquo;t exist:</p>

<pre><code>mkdir -p /etc/grafana/provisioning/datasources
mkdir -p /etc/grafana/provisioning/dashboards
mkdir -p /etc/grafana/crunchy_dashboards
</code></pre>

<table>
<thead>
<tr>
<th>pgmonitor Configuration File</th>
<th>System Location</th>
</tr>
</thead>

<tbody>
<tr>
<td>grafana/crunchy_grafana_datasource.yml</td>
<td><code>/etc/grafana/provisioning/datasources/datasource.yml</code></td>
</tr>

<tr>
<td>grafana/crunchy_grafana_dashboards.yml</td>
<td><code>/etc/grafana/provisioning/dashboards/dashboards.yml</code></td>
</tr>
</tbody>
</table>

<p>Review the crunchy_grafana_datasource.yml file to ensure it is looking at your Prometheus database. The included file assumes Grafana and Prometheus are running on the same system. DO NOT CHANGE the datasource &ldquo;name&rdquo; if you will be using the dashboards provided in this repo. They assume that name and will not work otherwise. Any other options can be changed as needed. Save the crunchy_grafana_datasource.yml file and rename to /etc/grafana/provisioning/datasources/datasources.yml. Restart grafana and confirm through the web interface that the datasource was provisioned and working.</p>

<p>Review the crunchy_grafana_dashboards.yml file to ensure it&rsquo;s looking at where you stored the provided dashboards. By default it is looking in /etc/grafana/crunchy_dashboards. Save this file and rename to /etc/grafana/provisioning/dashboards/dashboards.yml. Restart grafana so it picks up the new config.</p>

<p>Save all of the .json dashboard files to the /etc/grafana/crunchy_dashboards folder.</p>

<h2 id="setup">Setup</h2>

<h3 id="configuration-database">Configuration Database</h3>

<p>By default Grafana uses an SQLite database to store configuration and dashboard information. We recommend using a PostgreSQL database for better long term scalability. Before doing any further configuration, including changing the default admin password, set the grafana.ini to point to a postgresql instance that has a database created for it.</p>

<p>In psql run the following:</p>

<pre><code>CREATE ROLE grafana WITH LOGIN;
CREATE DATABASE grafana;
ALTER DATABASE grafana OWNER TO grafana;
\password grafana
</code></pre>

<p>You may also need to adjust your pg_hba.conf to allow grafana to connect to your database.</p>

<p>In your grafana.ini, set the following options at a minimum with relevant values:</p>

<pre><code>[database]

type = postgres
host = 127.0.0.1:5432
name = grafana
user = grafana
password = &quot;&quot;&quot;mypassword&quot;&quot;&quot;
</code></pre>

<p>Now enable and start the grafana service</p>

<pre><code>sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server
</code></pre>

<p>Navigate to the web interface: https://&lt;ip-address&gt;:3000. Log in with admin/admin (be sure to change the admin password) and check settings to ensure the postgres options have been set and are working.</p>

<h3 id="datasource-dashboard-provisioning">Datasource &amp; Dashboard Provisioning</h3>

<p>Grafana 5.x provides the ability to automatically provision datasources and dashboards via configuration files instead of having to manually import them either through the web interface or the API. Note that provisioned dashboards can no longer be directly edited and saved via the web interface. See the Grafana documentation for how to edit/save provisioned dashboards: <a href="http://docs.grafana.org/administration/provisioning/#making-changes-to-a-provisioned-dashboard">http://docs.grafana.org/administration/provisioning/#making-changes-to-a-provisioned-dashboard</a>. If you&rsquo;d like to customize these dashboards, we recommend first adding them via provisioning then exporting and importing manually via the web interface.</p>

<p>The extras package takes care of putting all these files in place. If you did not use the crunchy package to install grafana, see the additional instructions above. Once that is done, the only additional setup that needs to be done is to set the &ldquo;provisioning&rdquo; option in the grafana.ini to point to the top level directory if it hasn&rsquo;t been done already. If you&rsquo;re upgrading from Grafana 4.x to 5.x, you will have to add the &ldquo;provisioning&rdquo; option to the [paths] section of the grafana.ini file. Once that is done, just restart grafana and all datasources and dashboards should appear.</p>

<pre><code>[paths]
provisioning = /etc/grafana/provisioning
</code></pre>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="../exporter/" title="Setting up Exporters"> <i class="fa fa-chevron-left"></i><label>Setting up Exporters</label></a>
    <a class="nav nav-next" href="../prometheus/" title="Setting up Prometheus" style="margin-right: 0px;"><label>Setting up Prometheus</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

  </div>


	<div>


  



	</div>
</footer>

<link href="../css/featherlight.min.css" rel="stylesheet">
<script src="../js/featherlight.min.js"></script>



<script src="../theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>