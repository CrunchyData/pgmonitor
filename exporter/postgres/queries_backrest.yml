ccp_backrest_last_runtime:
    query: "SELECT config_file 
                , stanza
                , backup_type
                , EXTRACT(epoch FROM ((max(to_timestamp(backup_stop))) - (max(to_timestamp(backup_start))))) AS backup_runtime_seconds
          FROM monitor.pgbackrest_info() 
          GROUP BY config_file, stanza, backup_type"
    metrics:
        - config_file:
            usage: "LABEL"
            description: "Configuration file for this backup"
        - stanza:
            usage: "LABEL"
            description: "PGBackrest Stanza Name"
        - backup_type:
            usage: "LABEL"
            description: "Backup type"
        - backup_runtime_seconds:
            usage: "GAUGE"
            description: "Total runtime in seconds of this backup"


ccp_backrest_last_full_backup:
    query: "SELECT config_file 
                , stanza
                , EXTRACT(epoch FROM (CURRENT_TIMESTAMP - (max(to_timestamp(backup_stop)))))  AS time_since_completion_seconds
          FROM monitor.pgbackrest_info() WHERE backup_type = 'full' 
          GROUP BY config_file, stanza"
    metrics:
        - config_file:
            usage: "LABEL"
            description: "Configuration file for this backup"
        - stanza: 
            usage: "LABEL"
            description: "PGBackrest Stanza Name"
        - time_since_completion_seconds:
            usage: "GAUGE"
            description: "Seconds since the last completed full backup"


ccp_backrest_last_diff_backup:
    query: "SELECT config_file 
                , stanza
                , EXTRACT(epoch FROM (CURRENT_TIMESTAMP - (max(to_timestamp(backup_stop)))))  AS time_since_completion_seconds
          FROM monitor.pgbackrest_info() WHERE backup_type IN ('full', 'diff') 
          GROUP BY config_file, stanza"
    metrics:
        - config_file:
            usage: "LABEL"
            description: "Configuration file for this backup"
        - stanza: 
            usage: "LABEL"
            description: "PGBackrest Stanza Name"
        - time_since_completion_seconds:
            usage: "GAUGE"
            description: "Seconds since the last completed full or differential backup. Differential is always based off last full."


ccp_backrest_last_incr_backup:
    query: "SELECT config_file 
                , stanza
                , EXTRACT(epoch FROM (CURRENT_TIMESTAMP - (max(to_timestamp(backup_stop)))))  AS time_since_completion_seconds
          FROM monitor.pgbackrest_info() WHERE backup_type IN ('full', 'diff', 'incr') 
          GROUP BY config_file, stanza"
    metrics:
        - config_file:
            usage: "LABEL"
            description: "Configuration file for this backup"
        - stanza: 
            usage: "LABEL"
            description: "PGBackrest Stanza Name"
        - time_since_completion_seconds:
            usage: "GAUGE"
            description: "Seconds since the last completed full, differential or incremental backup. Incremental is always based off last full or differential."

